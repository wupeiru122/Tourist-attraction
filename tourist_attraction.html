<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <link rel="stylesheet" href="./style.css">
    <title>Viewpoint</title>

    <style>
        
    </style>
</head>

<body>

    <header class="container__header">
        <div class="header">
            <p class="header__title">臺北市-遊憩景點</p>  
        </div>            
    </header>

    <nav class="btnNav">

        <div class="search">
            <input id="searchText"><i class="fa-solid fa-magnifying-glass"></i>
        </div>

        <button id="btnPre">上一頁</button>
        <button id="btnNext">下一頁</button>

        <button id="btnFavorite">加入我的最愛</button>

        <a class="favList" href=""><i class="fa-solid fa-bookmark"></i>查看我的最愛</a>

    </nav>

    <main class="viewpoint" id="viewpoint"></main>

    
    
 
    <script>
        let spotList;

        //分頁
        let page = 1;
        document.querySelector('#btnPre').addEventListener('click', ()=> {
            page--;
            if(page === 0){
                page = 1;
                return;
            }
            getSpotList();
        });
        document.querySelector('#btnNext').addEventListener('click', ()=> {
            page++;
            getSpotList();
        });


        //加入最愛
        document.querySelector('#btnFavorite').addEventListener('click', () => {
            const spotCheckboxes = document.querySelectorAll('input:checked');
            const favSpotListStr = sessionStorage.getItem('favSpotList');
            const favSpotList = JSON.parse(favSpotListStr) ?? [];
            for (let spotCheckbox of spotCheckboxes){
                const spotId = +spotCheckbox.id.substr(2);
                const index = favSpotList.findIndex(spot => spot.id === spotId);
                if(index !== -1){
                    continue;
                }
                //const spot = spotList.filter(spot => spot.id === spotId)[0];
                favSpotList.push(spotList.find(spot => spot.id === spotId));
            }
            sessionStorage.setItem('favSpotList', JSON.stringify(favSpotList));
        });

        const viewpoint = document.querySelector('#viewpoint');
        let fakePic = 'https://via.placeholder.com/400x200';

        getSpotList();
        function getSpotList(){
            const url = `https://www.travel.taipei/open-api/zh-tw/Attractions/All?page=${page}`;
            fetch(url, {
                headers: {
                    Accept: 'application/json'
                }
            })
            .then(resp => resp.json())
            .then(body => {
                spotList = body.data;
                showSpotList(spotList);
            });
        }

        function showSpotList(spots){
            viewpoint.innerHTML = '';

            for (let spot of spots) {
                viewpoint.insertAdjacentHTML('beforeend', `
                <section class="col"">
                    <figure class="viewpointCard">
                        <img src="${spot.images[0]?.src ?? fakePic}" class="picCard" alt="...">
                        <figcaption class="card-body">
                            <input type="checkbox" id='cb${spot.id}'>
                            <h3 class="card-title" style="display:inline-block;">${spot.name}</h3>
                            <h4 class="card-distric"><i class="fa-solid fa-location-dot"></i>${spot.distric}</h4>
                            <p class="card-text" style="overflow: hidden;text-overflow: ellipsis;display: -webkit-box;-webkit-line-clamp: 5;-webkit-box-orient: vertical;">
                                ${spot.introduction}
                            </p>
                        </figcaption>
                    </figure>
                </section>
                `);
            };
        }

    

        
            
    </script>
</body>

</html>